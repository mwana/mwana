{% extends "base.html" %}
{% load i18n %}
{% block title %}AnthroWatch Reports - RapidSMS for Health{% endblock %}
{% block stylesheets %}
{{ block.super }}
<link type="text/css" rel="stylesheet"
      href="{{ STATIC_URL }}stylesheets/modules.css" />
<link type="text/css" rel="stylesheet"
      href="{{ STATIC_URL }}locations/stylesheets/locations.css" />
<link type="text/css" rel="stylesheet"
      href="{{ STATIC_URL }}locations/stylesheets/label-overlay.css" />
<link type="text/css" rel="stylesheet"
      href="{{ STATIC_URL }}labresults/stylesheets/labresults.css" />
<link type="text/css" rel="stylesheet"
      href="{{ STATIC_URL }}malawi/stylesheets/malawi.css" />
<link type="text/css" rel="stylesheet"
      href="{{ STATIC_URL }}malawi/stylesheets/daterangepicker-bs2.css" />
<style type="text/css" media="screen">
    span.x {
    color:#bbbbbb;
    background:transparent;
    display:block;
    text-align: center;
    }

    ul{
        border:0; margin:0; padding:0;
    }

    #pagination-clean li{
        border:0; margin:0; padding:0;
        font-size:11px;
        list-style:none;
    }
    #pagination-clean li, #pagination-clean a{
        border:solid 1px #DEDEDE
        margin-right:2px;
    }

    #pagination-clean .next a,
    #pagination-clean .previous a {
        font-weight:bold;
        font-size: 13px;
        border:solid 1px #FFFFFF;
    }
    #pagination-clean .active{
        color:#00000
        font-weight:bold;
        display:block;
       float:left;
        padding:0px 5px;
    }
    #pagination-clean a:link,
    #pagination-clean a:visited {
        color:#0033CC
        display:block;
        float:left;
        padding:3px 5px;
        text-decoration:none;
    }
    #pagination-clean a:hover{
        text-decoration:none;
    }

    /* style the current page */
    #pagination-clean .active a:link,
   #pagination-clean .active a:visited {
        color:#0033CC
        display:block;
        float:left;
        padding:3px 5px;
        text-decoration:none;
        font-weight: bold;
        font-size: 16px;
    }
    #pagination-clean .active a:hover{
        text-decoration:none;
        font-weight: bold;
        font-size: 16px;
    }

 </style>  
</style>
{% endblock %}

{% block javascripts %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}malawi/javascripts/moment.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}malawi/javascripts/daterangepicker.js"></script>
{% endblock javascripts %}

{% block content %}
<div class="span12">
<div class="page-header">
  <h1>AnthroWatch Reports</h1>
</div>

<!-- <h3>Report Options</h3> -->
<form method="GET" id="remindmi_options" action="">
<div class="well flush row-fluid">
  <div class="span12">
    <!-- Legend ? -->
    <div class="row-fluid">
      <div class="span4">
	<!-- r1c1 -->
	<label for="location">Location:</label>
	<select name="location" id="location" value="{{location}}" class="pull-right">
          <option value="All Districts"  
                  {% ifequal selected_location "All Districts" %}
                  selected="selected" 
                  {% endifequal %}>All Districts</option>
          {% for location in locations %}
          <option value="{{ location }}"
		  {% ifequal selected_location location %} 
		  selected="selected" 
		  {% endifequal %}>{{ location }}</option>
	  {% endfor %}
        </select>	
	<div class="row-fluid">
	  <div class="span12">
	    <br />
	    <!-- r2c1 -->
	    <label for="status">Status:</label>
	    <select name="status" value="{{ status }}" class="pull-right" id="status">
              {% for option in  stat_options %}
              <option value="{{ option }}"
		    {% ifequal option selected_status %}
                    selected="selected"
		    {% endifequal %}>{{ option }}</option>
            {% endfor %}
	    </select>
	  </div>
	</div>
      </div>
      <div class="span4">
	<!-- r1c2 -->
	<br />
	<br />
	<div class="row-fluid">
	  <div class="span12">
	    <br />
	    <!-- r2c2 -->
	    <label for="action_taken">Action Taken:</label>
	    <select name="action_taken" id="action_taken" value="{{ action_taken }}" class="pull-right">
              {% for action in action_options %}
              <option value="{{ action }}"
		      {% ifequal action selected_action %}
                      selected="selected"
		      {% endifequal %}>{{ action }}</option>
              {% endfor %}
	    </select>
	  </div>
	</div>
      </div>
      <div class="span4">
	<!-- r1c3 -->
	<div id="reportrange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
	  <i class="glyphicon glyphicon-calendar icon-calendar icon-large"></i>
	  <span></span> <b class="caret"></b>
	</div>
	<script type="text/javascript" src="{{ STATIC_URL }}malawi/javascripts/reportrange.js"></script>
	<div class="row-fluid">
	  <div class="span12">
	    <br />
	    <!-- r2c3 -->
	    <input type="hidden" name="startdate" value='{{startdate}}' id="startdate" />
	    <input type="hidden" name="enddate" value='{{enddate}}' id="enddate" />
	    <button type="submit" class="btn btn-primary pull-right" id="update_report" name="update_report">Update Report</button>
	  </div>
	</div>
      </div>
    </div>
  </div>
</div>
</form>

<div class="module">

<h2>Analyzed Growth Monitor Surveys by period and location</h2>
<br />
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Date Submitted</th><th>Facility</th><th>District</th><th>Healthworker</th><th>Child ID</th><th>Sex</th><th>Date of Birth</th><th>Age</th><th>Height</th><th>Weight</th><th>Oedema</th><th>MUAC</th><th>Weight for Height Z</th><th>Wasting</th><th>Weight for Age Z</th><th>Underweight</th><th>Height for Age Z</th><th>Stunting</th><th>Data Quality</th><th>Action Taken</th>
            </tr>
        </thead>
        <tbody>
            {% for ass in ass_list.object_list %}
            <tr>
                <td>{{ ass.date|date:"Y-m-d" }}</td>
                <td>{{ ass.healthworker.clinic }}</td>
                <td>{{ ass.healthworker.clinic.parent.name }}</td>
                <td title="Contact on {{ ass.healthworker.default_connection.identity }}">{{ ass.healthworker.name }}</td>
                <td>{{ ass.patient.code }}</td>
                <td>{{ ass.patient.gender }}</td>
                <td>{{ ass.patient.date_of_birth }}</td>
                <td>{{ ass.patient.age_in_months }}</td>
                <td>{{ ass.height|default:"<span class='x'>X</span>" }}</td>
                <td>{{ ass.weight|default:"<span class='x'>X</span>" }}</td>
                <td {% if ass.oedema %}class="oedema"{% endif %}>{{ ass.oedema|yesno:"Yes,No, " }}</td>
                <td {% if ass.muac %}class="{{ ass.get_wasting_display|slugify }}"{% endif %}>{{ ass.muac|default:"<span class='x'>X</span>" }}</td>
                <td {% if ass.weight4height %}class="{{ ass.get_wasting_display|slugify }}"{% endif %}>{{ ass.weight4height|default:"<span class='x'>X</span>" }}</td>
                <td class="{{ ass.get_wasting_display|slugify }}">{{ ass.get_wasting_display|default:"<span class='x'>X</span>" }}</td>
                <td class="{{ ass.get_underweight_display|slugify }}">{{ ass.weight4age|default:"<span class='x'>X</span>" }}</td>
                <td class="{{ ass.get_underweight_display|slugify }}">{{ ass.get_underweight_display|default:"<span class='x'>X</span>" }}</td>
                <td class="{{ ass.get_stunting_display|slugify }}">{{ ass.height4age|default:"<span class='x'>X</span>" }}</td>
                <td class="{{ ass.get_stunting_display|slugify }}">{{ ass.get_stunting_display|default:"<span class='x'>X</span>" }}</td>
                <td>{{ ass.get_status_display }}</td>
                <td>{% if ass.action_taken == 'XX' %} <span class='x'>X</span> {% else %} {{ ass.get_action_taken_display }} {% endif %}</td> 
            </tr>
            {% endfor %}
            <tr>
                <td colspan="20">&nbsp;</td>
            </tr>
        </tbody>
    </table>
    <div class="pagination">
        <ul id="">
        {% if ass_list.has_previous %}
            <li class="previous"><a href="?page={{ass_list.previous_page_number }}&location={{ selected_location }}&startdate={{ startdate }}&enddate={{ enddate }}&action_taken={{ selected_action }}&status={{ selected_status }}">Previous</a></li>
        {% endif %}
        {% for pg in ass_list.paginator.page_range %}
            {% if ass_list.number == pg %}
              <li class="active"><a href="?page={{ pg }}&location={{ selected_location }}&startdate={{ startdate }}&enddate={{ enddate }}&action_taken={{ selected_action }}&status={{ selected_status }}">{{ pg }}</a></li>
            {% else %}
              <li><a href="?page={{ pg }}&location={{ selected_location }}&startdate={{ startdate }}&enddate={{ enddate }}&action_taken={{ selected_action }}&status={{ selected_status }}">{{ pg }}</a></li>
            {% endif %}
        {% endfor %}
        {% if ass_list.has_next %}
            <li class="next"><a href="?page={{ass_list.next_page_number }}&location={{ selected_location }}&startdate={{ startdate }}&enddate={{ enddate }}&action_taken={{ selected_action }}&status={{ selected_status }}">Next</a></li>
        {% endif %}
        </ul>
    </div>
</div>
<div class="toolbar">
    <a href="/growth/csv/assessments/?location={{ selected_location }}&startdate={{ startdate }}&enddate={{ enddate }}&action_taken={{ selected_action }}&status={{ selected_status }}" class="export">Export Analyzed Surveys</a>
</div>
<h3>Legend</h3>
  <p>
    C-R = Counseling to reinforce good practices
    <br />
    C-OFP = Counseling to optimal feeding practices
    <br />
    R-SFP = Refer to supplementary Feeding Programme
    <br />
    R-OTP = Refer to Outpatient Therapeutic Programme
    <br />
    R-NRU = Refer to Nutrition Rehabilitation Unit
    <br />
    X = Indicator was not reported on
  </p>
</div>

<div class="module">
<h2>Raw Survey Entries</h2>

<div class="toolbar">
   	<a href="/growth/csv/surveyentries/" class="export">Export Raw Survey Entries</a>
</div>

</div>

</div>
{% endblock %}
