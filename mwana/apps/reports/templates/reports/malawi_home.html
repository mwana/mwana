{% extends "layout.html" %}
{% load forms_tags %}
{% load labresults_tags %}

{% block title %}RapidSMS for Health - {{ block.super }}{% endblock %}

{% block javascripts %}
{{ block.super }}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="{{ STATIC_URL }}locations/javascripts/mask.js" type="text/javascript"></script>
<script type="text/javascript" src="{{ STATIC_URL }}malawi/javascripts/datepicker.js"></script>
<script type="text/javascript">
    // <![CDATA[     
       
    datePickerController.addEvent(window, "load", function() {
          var start_opts = {
            // The ID of the associated form element
            id:"startdate",
            // The date format to use
            format:"Y-ds-m-ds-d",

            // Do we hide the today button
            noToday:true,
            // Do we show weeks along the left hand side
            showWeeks:true,

            // Do we fill the entire grid with dates
            fillGrid:true,
          };
          var end_opts = {
            // The ID of the associated form element
            id:"enddate",
            // The date format to use
            format:"Y-ds-m-ds-d",

            // Do we hide the today button
            noToday:true,
            // Do we show weeks along the left hand side
            showWeeks:true,

            // Do we fill the entire grid with dates
            fillGrid:true,
          };
          datePickerController.createDatePicker(start_opts);
          datePickerController.createDatePicker(end_opts);
    });

    // ]]>
</script>
{% endblock %}

{% block stylesheets %}
{{ block.super }}
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}locations/stylesheets/locations.css" />
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}locations/stylesheets/label-overlay.css" />
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}labresults/stylesheets/labresults.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}malawi/stylesheets/datepicker.css" type="text/css" media="screen" />
<style type="text/css">
#options form {margin:20px; padding: 10px;}
</style>
{% endblock %}

{% block content %}
<div class="module">
    <h2>Map <span>of active Locations since {{ startdate }}</span></h2>
    <div class="map">
        <div id="map"></div>
    </div>
</div>

<div class="split-3">
    <div class="left">
        <div class="module">
            <h2>Results160</h2>
            <div class="toolbar">
                <a href="/results160">All Reports</a>
            </div>
            <ul class="stats">
                <li>
                    <div class="report">{{ loc_count }}</div>
                    <div class="caption">Number of active sites</div>
                </li>
                <li>
                    <div class="report">{{ eid_processed }}</div>
                    <div class="caption">EID samples Processed at Lab</div>
                </li>
                <li>
                    <div class="report">{{ res_count }}</div>
                    <div class="caption">Results Delivered to Clinic by SMS</div>
                </li>
            </ul>
        </div>
    </div>

    <div class="mid">
        <div class="module">
        <h2>RemindMi</h2>
            <div class="toolbar">
                 <a href="/remindmi">All Stats</a>
            </div>
            <ul class="stats">
                <li>
                    <div class="report">{{ mothers_registered }}</div>
                    <div class="caption">Mothers Registered</div>
                </li>
                <li>
                    <div class="report">{{ all_msgs }}</div>
                    <div class="caption">"All" Messages Sent</div>
                </li>
                <li>
                    <div class="report">{{ births_registered }}</div>
                    <div class="caption">Births Reported</div>
                </li>
            </ul>
        </div>
    </div>

    <div class="right">
      <div class="module">
        <h2>Anthrowatch</h2>
        <div class="toolbar">
            <a href="/growth">All Stats</a>
        </div>
        <ul class="stats">
            <li>
              <div class="report">{{ ass_count }}</div>
              <div class="caption">Number of children assessed</div>
            </li>
          <li>
            <div class="report">{{ ass_suspect }}</div>
            <div class="caption">Number of suspect cases</div>
          </li>
          <li>
            <div class="report">{{ ass_severe }}</div>
            <div class="caption">Severe cases (Underweight, Stunting, or Wasting)</div>
          </li>
        </ul>
    </div>
  </div>
</div>
<div class="clear-hack"></div>

<div class="module">
    <h2>Select reporting period start date:</h2>
      <div id="options" class="report">
        <form name="reportPeriod" method="GET" action="">
          <label for="startdate">From:</label>
          <input type="textbox" name="start_date" value='{{startdate}}' id="startdate" class="dateformat-Y-ds-m-ds-d" />
          <input type="submit" name="SubmitValues" value="Ok" />
        </form>
        <br>
      </div>
</div>

<div id="location_data" style="display: none;">
    <ul>{% for location in locations %}
        <li lat="{{ location.point.latitude }}" lng="{{ location.point.longitude }}" slug="{{ location.slug|upper }}" name="{{ location.name }}">
            {% render_location %}
        </li>
        {% endfor %}
    </ul>
</div>

<script type="text/javascript">
    $(function() {

        /* initialize the google map */
        var map = new google.maps.Map(
            $("#map").get(0), {
                mapTypeId: google.maps.MapTypeId.TERRAIN,
                center: new google.maps.LatLng(-13.966, 33.761),
                zoom: 1
            }
        );

        var bounds = new google.maps.LatLngBounds();
        
        $("#location_data ul li").each(function() {
            var loc = $(this);
            var lat = loc.attr("lat");
            var lng = loc.attr("lng");
            if(lat && lng) {
                
                var infowindow = new google.maps.InfoWindow({
                    "content": loc.html()
                });
                
                var point = new google.maps.LatLng(lat, lng);
                var marker = new google.maps.Marker({
                    "position": point,
                    "title": loc.attr("name") + " (" + loc.attr("slug") + ")",
                    "map": map
                }); 
                    
                google.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(map,marker);
                });
                
                bounds.extend(point);
                
            }
        });

        map.fitBounds(bounds);
    });
</script>
{% endblock %}
