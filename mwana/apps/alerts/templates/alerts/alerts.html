{# TODO: Find a better way of displaying the alerts to avoid repeating code #}
{% extends "layout.html" %}
{% load forms_tags %}

{% block title %}Mwana Alerts - {{ block.super }}{% endblock %}

{% block stylesheets %}
{{ block.super }}
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reports/stylesheets/chosen.css" />
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}reports/stylesheets/navi.css" />
{% endblock %}

{% block javascripts %}
{{ block.super }}
{# TODO: Factor put this script to a single javascript file #}
<script type="text/javascript" src="{{ MEDIA_URL }}reports/javascripts/jquery-1.8.0.min.js" ></script>
<script type="text/javascript" src="{{ MEDIA_URL }}reports/javascripts/chosen.jquery.min.js" ></script>
<script type="text/javascript" src="{{ MEDIA_URL }}reports/javascripts/location_selector.js" ></script>

{% endblock %}



{% block content %}

<form name="form1">
    <div class="split-2">
        <div class="left">
            <div class="module">
                <h2>Results160 Alerts on {% now "jS F Y" %} at {% now "H:i" %}</h2>
                <br>
                Generated by <b>{{ user.username|title }}</b>
                        <table border="1" width="100%" id="input_parameters_table">
                    <thead>
                    <th>Province</th>
                    <th>District</th>
                    <th>Facility</th>
                    <th>Implementer</th>
                    <th></th>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{% autoescape off %}
                                {{rpt_provinces}}
                                {% endautoescape %}
                            </td>
                            <td>{% autoescape off %}
                                {{rpt_districts}}
                                {% endautoescape %}
                            </td>
                            <td>{% autoescape off %}
                                {{rpt_facilities}}
                                {% endautoescape %}
                            </td>
                            <td>{% if is_report_admin %}
                                {% autoescape off %}
                                {{rpt_group}}
                                {% endautoescape %}
                                {%endif%}</td>
                            <td><input type="submit" value="Ok" name="SubmitValues" /></td>
                        </tr>
                    </tbody>
                </table>
                <h1 id="LabIssues">Lab Issues:</h1>
                <p align="center">
                <h3 id="LabsNotProcessingDBS">Alerts for Labs Not Processing DBS samples in the last {{ lab_processing_days }} days.</h3>
                <br>Select date range (days)
                <select name="input_lab_processing_days" size="1">
                    {% for a in days%}
                    {% ifequal a lab_processing_days %}
                    <option selected value="{{a}}">{{a}}</option>
                    {% else%}
                    <option value="{{a}}">{{a}}</option>
                    {% endifequal %}
                    {%endfor%}

                </select>

                <input type="submit" value="Update" name="SubmitValues2" />

                <p>
                    {% for record in not_processing_dbs %}
                <table border="1"  width="100%">
                    <tr>
                        {% ifequal record.level record.HIGH_LEVEL %}
                        <td width="50" bgcolor="#FF0000"></td>
                        {% else%}
                        <td width="50" bgcolor="#FFFF00"></td>
                        {% endifequal%}
                        <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                        <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                        <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                    </tr>
                </table>
                {% endfor %}

                <p><p>
                <hr>
                <!-- Alert Report 5-->
                <p align="center">
                <h3 id="LabsNotSendingPayloads">Alerts for Labs Not Sending DBS Data in the last {{ lab_sending_days }} days.</h3>
                <br>Select date range (days)
                <select name="input_lab_sending_days" size="1">
                    {% for a in days%}
                    {% ifequal a lab_sending_days %}
                    <option selected value="{{a}}">{{a}}</option>
                    {% else%}
                    <option value="{{a}}">{{a}}</option>
                    {% endifequal %}
                    {%endfor%}

                </select>

                <input type="submit" value="Update" name="SubmitValues2" />

                <p>
                    {% for record in not_sending_dbs %}
                <table border="1"  width="100%">
                    <tr>
                        {% ifequal record.level record.HIGH_LEVEL %}
                        <td width="50" bgcolor="#FF0000"></td>
                        {% else%}
                        <td width="50" bgcolor="#FFFF00"></td>
                        {% endifequal%}
                        <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                        <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                        <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                    </tr>
                </table>
                {% endfor %}
                <p><p>
                <hr>
                <!--Resport3-->
                {% if not_sending_dbs_alerts%}
                <h1 id="HubIssues">Hub Issues:</h1>
                <p align="center">
                <h3 id="HubsNotSendingSamples">Alerts for Clinic Hubs Not Sending Samples to Labs in the last {{ transport_time }} days</h3>
                <br>
                Select date range (days)
                <select name="input_transport_time" size="1">
                    {% for a in days%}
                    {% ifequal a transport_time%}
                    <option selected value="{{a}}">{{a}}</option>
                    {% else%}
                    <option value="{{a}}">{{a}}</option>
                    {% endifequal %}
                    {%endfor%}

                </select>

                <input type="submit" value="Update" name="SubmitValues" />


                <p>
                    {% for record in not_sending_dbs_alerts %}
                <table border="1"  width="100%">
                    <tr>
                        {% ifequal record.level record.HIGH_LEVEL %}
                        <td width="50" bgcolor="#FF0000"></td>
                        {% else%}
                        <td width="50" bgcolor="#FFFF00"></td>
                        {% endifequal%}
                        <td width="50" bgcolor="#FFFFFF" align="center">
                            <font size="6">
                                {% if record.days_late > 991 %}
                                Never
                            </font><br>&nbsp;&nbsp;sent</td>
                        {% else %}
                        {{ record.days_late }}
                    </font><br>&nbsp;&nbsp;days</td>
                    {% endif %}

                    <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                    <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                    </tr>
                </table>
                {% endfor %}

                <p><p>
                <hr>
                {% endif %}
                <h1 id="ClinicIssues">Clinic Issues:</h1>
                <div>
                    <!-- Report 1-->
                    <p align="center">
                    <h3 id="ClinicsNotRetrievingResults">Alerts for Clinics Not Retrieving Results in the last {{ retrieving_time }} days</h3>
                    <br>Select date range (days)
                    <select name="input_retrieving_time" size="1">
                        {% for a in days%}
                        {% ifequal a retrieving_time%}
                        <option selected value="{{a}}">{{a}}</option>
                        {% else%}
                        <option value="{{a}}">{{a}}</option>
                        {% endifequal %}
                        {%endfor%}

                    </select>
                    <input type="submit" value="Update" name="SubmitValues2" />
                    <p align="center">
                        {% for record in not_retrieving_results %}
                    <table border="1" width="100%">
                        <tr>
                            {% ifequal record.level record.HIGH_LEVEL %}
                            <td width="50" bgcolor="#FF0000"></td>
                            {% else%}
                            <td width="50" bgcolor="#FFFF00"></td>
                            {% endifequal%}
                            <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                            <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                            <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                        </tr>
                    </table>
                    {% endfor %}

                    <p><p>
                    <hr>
                    <!-- Report 2-->
                    <p align="center">
                    <h3 id="ClinicsNotSendingDBS">Alerts for Clinics Not Sending DBS Samples in the last {{ notifying_time }} days</h3>
                    <br>Select date range (days)
                    <select name="input_notifying_time" size="1">
                        {% for a in days%}
                        {% ifequal a notifying_time %}
                        <option selected value="{{a}}">{{a}}</option>
                        {% else%}
                        <option value="{{a}}">{{a}}</option>
                        {% endifequal %}
                        {%endfor%}

                    </select>

                    <input type="submit" value="Update" name="SubmitValues2" />
                    <p>
                        {% for record in not_notifying_or_using_results %}

                    <table border="1"  width="100%">
                        <tr>
                            {% ifequal record.level record.HIGH_LEVEL %}
                            <td width="50" bgcolor="#FF0000"></td>
                            {% else%}
                            <td width="50" bgcolor="#FFFF00"></td>
                            {% endifequal%}
                            <td width="50" bgcolor="#FFFFFF" align="center">
                                <font size="6">
                                    {% if record.days_late > 40000 %}
                                    Never
                                </font><br>&nbsp;&nbsp;sent</td>
                            {% else %}
                            {{ record.days_late }}
                        </font><br>&nbsp;&nbsp;days</td>
                        {% endif %}


                        <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                        <td bgcolor="#FFFFFF">{{ record.message }} <p><b>{{ record.extra }}</b></td>
                        </tr>
                    </table>
                    {% endfor %}


                    <p><p>

                    <hr>
                    <h1 id="TracingIssues">Tracing Issues:</h1>
                    <!-- Alert Report 6-->
                    <p align="center">
                    <h3>Alerts for clinics not using the trace command in the last {{ tracing_days }} days.</h3>
                    <br>Select date range (days)
                    <select name="input_tracing_days" size="1">
                        {% for a in days%}
                        {% ifequal a tracing_days %}
                        <option selected value="{{a}}">{{a}}</option>
                        {% else%}
                        <option value="{{a}}">{{a}}</option>
                        {% endifequal %}
                        {%endfor%}

                    </select>

                    <input type="submit" value="Update" name="SubmitValues2" />

                    <p>
                        {% for record in not_using_trace %}
                    <table border="1"  width="100%">
                        <tr>
                            {% ifequal record.level record.HIGH_LEVEL %}
                            <td width="50" bgcolor="#FF0000"></td>
                            {% else%}
                            <td width="50" bgcolor="#FFFF00"></td>
                            {% endifequal%}
                            <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                            <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                            <td bgcolor="#FFFFFF">{{ record.message }} <b>{{ record.extra }}</b></td>
                        </tr>
                    </table>
                    {% endfor %}
                    <p><p><hr>
                    <h1>Staff Issues:</h1><p>
                    <h3 id="StaffNotUsingResults160">Alerts for Clinic staff not using Results160</h3>
                    <p>
                        {% for record in inactive_workers_alerts %}

                    <table border="1"  width="100%">
                        <tr>
                            {% ifequal record.level record.HIGH_LEVEL %}
                            <td width="50" bgcolor="#FF0000"></td>
                            {% else%}
                            <td width="50" bgcolor="#FFFF00"></td>
                            {% endifequal%}
                            <td width="50" bgcolor="#FFFFFF" align="center"><font size="6">{{ record.days_late }}</font><br>&nbsp;&nbsp;days</td>
                            <td width="80" bgcolor="#EBEBEB">{{ record.culprit }}</td>
                            <td bgcolor="#FFFFFF">{{ record.message }} <p><b>{{ record.extra }}</b></td>
                        </tr>
                    </table>
                    {% endfor %}
                    <p><p>
                </div>
                <p>
            </div>
            <div class="clear-hack"></div>
        </div>
    </div>    
</form>
<div id="floating-navigator">
    <div id="title"> Quick Navigator</div><p></p>
    <a href="#LabIssues">Lab Issues:</a><p>
        <a href="#LabsNotSendingPayloads">Labs Not Sending DBS Data</a><p>
        <a href="#HubIssues">Hub Issues:</a><p>
        <a href="#ClinicIssues">Clinic Issues:</a><p>
        <a href="#ClinicsNotSendingDBS">Clinics Not Sending DBS Samples</a><p>
        <a href="#TracingIssues">Tracing Issues:</a><p>        
</div>
<script type="text/javascript">
    $("#rpt_group").chosen();
</script>
{% endblock %}
